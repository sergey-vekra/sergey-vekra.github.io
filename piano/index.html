<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Scale & Chord Visualizer</title>
    <style>
        :root {
            --bg: #1a1a2e;
            --text: #e0e0e0;
            --white-key: #ffffff;
            --black-key: #111111;
            --highlight: #4ca1af;
            --root-color: #e63946;
            --chord-bg: #16213e;
            --control-bg: #2c2c54;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            align-items: center;
        }

        select {
            padding: 10px;
            font-size: 16px;
            background-color: var(--control-bg);
            color: white;
            border: 1px solid var(--highlight);
            border-radius: 5px;
            cursor: pointer;
            outline: none;
        }

        .btn-transpose {
            padding: 10px 15px;
            font-size: 18px;
            font-weight: bold;
            background-color: var(--control-bg);
            color: var(--highlight);
            border: 1px solid var(--highlight);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            width: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-transpose:hover {
            background-color: var(--highlight);
            color: white;
        }

        .btn-transpose:active {
            transform: scale(0.95);
        }

        /* PIANO CSS */
        .piano-container {
            position: relative;
            height: 200px;
            width: 840px;
            /* 14 white keys * 60px */
            display: flex;
            user-select: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .key {
            position: relative;
            box-sizing: border-box;
            border-radius: 0 0 5px 5px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 15px;
            font-weight: bold;
            color: #555;
            transition: background-color 0.2s;
        }

        .white {
            width: 60px;
            height: 200px;
            background-color: var(--white-key);
            border: 1px solid #ccc;
            z-index: 1;
        }

        .black {
            width: 40px;
            height: 120px;
            background-color: var(--black-key);
            color: #aaa;
            position: absolute;
            z-index: 2;
            margin-left: -20px;
        }

        /* HIGHLIGHT STATES */
        .key.in-scale {
            background-color: var(--highlight);
            color: white;
        }

        .key.black.in-scale {
            background-color: #2c7280;
            color: white;
        }

        .key.root {
            background-color: var(--root-color);
            color: white;
        }

        .key.black.root {
            background-color: #a82430;
            color: white;
        }

        .key.chord-note {
            background-color: #f1c40f !important;
            color: black !important;
        }

        /* Yellow for hover */

        /* CHORDS SECTION */
        .chords-container {
            margin-top: 40px;
            width: 840px;
        }

        .chords-title {
            text-align: center;
            margin-bottom: 20px;
            color: #aaa;
        }

        .chord-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
        }

        .chord-card {
            background-color: var(--chord-bg);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chord-card:hover {
            transform: translateY(-5px);
            border-color: #f1c40f;
            box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2);
        }

        .step-num {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 5px;
        }

        .chord-name {
            font-size: 1.4em;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }

        .chord-notes {
            font-size: 0.8em;
            color: #aaa;
        }

        .chord-type {
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #4ca1af;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <h1>Piano Scale & Chord Visualizer</h1>

    <div class="controls">
        <button class="btn-transpose" id="btn-prev" title="Down 1 Semitone">-</button>

        <select id="root-note">
            <option value="0">C</option>
            <option value="1">C# / Db</option>
            <option value="2">D</option>
            <option value="3">D# / Eb</option>
            <option value="4">E</option>
            <option value="5">F</option>
            <option value="6">F# / Gb</option>
            <option value="7">G</option>
            <option value="8">G# / Ab</option>
            <option value="9">A</option>
            <option value="10">A# / Bb</option>
            <option value="11">B</option>
        </select>

        <button class="btn-transpose" id="btn-next" title="Up 1 Semitone">+</button>

        <select id="scale-type" style="margin-left: 15px;">
            <option value="major">Major (Ionian)</option>
            <option value="minor">Natural Minor (Aeolian)</option>
            <option value="harmonic_minor">Harmonic Minor</option>
            <option value="dorian">Dorian</option>
            <option value="mixolydian">Mixolydian</option>
            <option value="phrygian">Phrygian</option>
            <option value="lydian">Lydian</option>
        </select>
    </div>

    <!-- The Keyboard is generated via JS -->
    <div class="piano-container" id="piano"></div>

    <div class="chords-container">
        <div class="chords-title">Hover over a chord to see its notes on the piano</div>
        <div class="chord-grid" id="chord-grid">
            <!-- Chords injected via JS -->
        </div>
    </div>

    <script>
        const NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const ROMAN_NUMERALS = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];

        // Scale intervals (in semitones from root)
        const SCALES = {
            'major': [0, 2, 4, 5, 7, 9, 11],
            'minor': [0, 2, 3, 5, 7, 8, 10],
            'harmonic_minor': [0, 2, 3, 5, 7, 8, 11],
            'dorian': [0, 2, 3, 5, 7, 9, 10],
            'mixolydian': [0, 2, 4, 5, 7, 9, 10],
            'phrygian': [0, 1, 3, 5, 7, 8, 10],
            'lydian': [0, 2, 4, 6, 7, 9, 11]
        };

        // Piano layout logic (2 octaves)
        const WHITE_KEYS = [0, 2, 4, 5, 7, 9, 11, 12, 14, 16, 17, 19, 21, 23];
        const BLACK_KEYS = [1, 3, 6, 8, 10, 13, 15, 18, 20, 22];

        const pianoEl = document.getElementById('piano');
        const chordGridEl = document.getElementById('chord-grid');
        const rootSelect = document.getElementById('root-note');
        const scaleSelect = document.getElementById('scale-type');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');

        // Create the piano DOM elements
        function createPiano() {
            // First render white keys
            WHITE_KEYS.forEach((noteValue, index) => {
                const key = document.createElement('div');
                key.classList.add('key', 'white');
                key.dataset.note = noteValue % 12; // 0-11
                key.dataset.absolute = noteValue;  // 0-23
                key.innerText = NOTE_NAMES[noteValue % 12];
                pianoEl.appendChild(key);
            });

            // Then place black keys using absolute positioning
            const whiteKeyWidth = 60;
            BLACK_KEYS.forEach(noteValue => {
                const key = document.createElement('div');
                key.classList.add('key', 'black');
                key.dataset.note = noteValue % 12;
                key.dataset.absolute = noteValue;
                key.innerText = NOTE_NAMES[noteValue % 12];

                // Calculate left position based on which white key it follows
                let precedingWhiteKeys = WHITE_KEYS.filter(w => w < noteValue).length;
                key.style.left = `${precedingWhiteKeys * whiteKeyWidth}px`;
                pianoEl.appendChild(key);
            });
        }

        // Get actual scale notes based on selections
        function getCurrentScale() {
            const root = parseInt(rootSelect.value);
            const scaleType = scaleSelect.value;
            const intervals = SCALES[scaleType];

            return intervals.map(interval => (root + interval) % 12);
        }

        // Highlight piano keys
        function updatePiano() {
            const scaleNotes = getCurrentScale();
            const rootNote = parseInt(rootSelect.value);

            // Reset all keys
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('in-scale', 'root', 'chord-note');
                const note = parseInt(key.dataset.note);
                if (scaleNotes.includes(note)) {
                    key.classList.add('in-scale');
                }
                if (note === rootNote) {
                    key.classList.add('root');
                }
            });
        }

        // Calculate and render chords
        function updateChords() {
            chordGridEl.innerHTML = '';
            const root = parseInt(rootSelect.value);
            const intervals = SCALES[scaleSelect.value];

            // Reconstruct the 12-note scale absolute values for math
            const scaleAbs = intervals.map(i => root + i);

            for (let i = 0; i < 7; i++) {
                // Diatonic chords are built by stacking thirds (skipping a scale degree)
                const rootIdx = i;
                const thirdIdx = (i + 2) % 7;
                const fifthIdx = (i + 4) % 7;

                // Calculate absolute semitones to determine chord quality
                let n1 = scaleAbs[rootIdx];
                let n2 = scaleAbs[thirdIdx] + (thirdIdx < rootIdx ? 12 : 0);
                let n3 = scaleAbs[fifthIdx] + (fifthIdx < rootIdx ? 12 : 0);

                const thirdInterval = n2 - n1;
                const fifthInterval = n3 - n1;

                let quality = "";
                let suffix = "";
                if (thirdInterval === 4 && fifthInterval === 7) { quality = "Major"; suffix = ""; }
                else if (thirdInterval === 3 && fifthInterval === 7) { quality = "Minor"; suffix = "m"; }
                else if (thirdInterval === 3 && fifthInterval === 6) { quality = "Diminished"; suffix = "dim"; }
                else if (thirdInterval === 4 && fifthInterval === 8) { quality = "Augmented"; suffix = "aug"; }

                const rootName = NOTE_NAMES[n1 % 12];
                const thirdName = NOTE_NAMES[n2 % 12];
                const fifthName = NOTE_NAMES[n3 % 12];

                // Create Card
                const card = document.createElement('div');
                card.classList.add('chord-card');

                // Roman numeral capitalization based on quality
                let roman = ROMAN_NUMERALS[i];
                if (quality === "Minor" || quality === "Diminished") roman = roman.toLowerCase();
                if (quality === "Diminished") roman += "Â°";

                card.innerHTML = `
                    <div class="step-num">${roman}</div>
                    <div class="chord-name">${rootName}${suffix}</div>
                    <div class="chord-notes">${rootName} - ${thirdName} - ${fifthName}</div>
                    <div class="chord-type">${quality}</div>
                `;

                // Add Hover interactivity
                card.addEventListener('mouseenter', () => highlightChord(n1 % 12, n2 % 12, n3 % 12));
                card.addEventListener('mouseleave', updatePiano); // Reset to scale

                chordGridEl.appendChild(card);
            }
        }

        // Highlight specific chord notes on hover
        function highlightChord(r, t, f) {
            document.querySelectorAll('.key').forEach(key => {
                const note = parseInt(key.dataset.note);
                if (note === r || note === t || note === f) {
                    key.classList.add('chord-note');
                } else {
                    key.classList.remove('chord-note');
                }
            });
        }

        // Change root note by delta (+1 or -1)
        function changeRoot(delta) {
            let current = parseInt(rootSelect.value);
            // +12 ensures we handle negative numbers correctly (modulo in JS can be tricky with negatives)
            let next = (current + delta + 12) % 12;
            rootSelect.value = next;
            triggerUpdate();
        }

        function triggerUpdate() {
            updatePiano();
            updateChords();
        }

        // Initialization
        createPiano();
        triggerUpdate();

        // Event Listeners
        rootSelect.addEventListener('change', triggerUpdate);
        scaleSelect.addEventListener('change', triggerUpdate);

        btnPrev.addEventListener('click', () => changeRoot(-1));
        btnNext.addEventListener('click', () => changeRoot(1));

    </script>
</body>

</html>